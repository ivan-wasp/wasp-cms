<ion-header class="ion-no-border">
    <ion-toolbar class="bg-major-color">
        <ion-buttons slot="start">
            <ion-menu-button></ion-menu-button>
        </ion-buttons>



        <ion-title class="hidden-xs-down">用戶</ion-title>
        <ion-buttons slot="end">
            <ion-button (click)="commonService?.openCMSPage('/admin-notification', 'root')" fill="clear">
                <ion-icon slot="start" src="assets/icon/user.svg"></ion-icon>
                管理員通知
            </ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
            <ion-button (click)="commonService?.openCMSPage('/user-detail', 'root')" fill="clear">
                <ion-icon slot="start" src="assets/icon/user.svg"></ion-icon>
                新增用戶
            </ion-button>
        </ion-buttons>
        <ion-buttons slot="end" (click)="getUserDataList(true)">
            <ion-button fill="clear" class="export-excel-btn">
                <ion-icon slot="start" src="assets/icon/excel.svg"></ion-icon>
                輸出至Excel
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="bg-color">
    <div>
        <ion-row>
            <ion-col size-xs="12" size-sm="12" size-md="4" size-lg="4" class="ion-align-self-center">
                <ion-select (ionChange)="resetAndGetData($event)" class="filter-ion-select" interface="popover"
                    mode="ios" [(ngModel)]="deposit" multiple="false" cancelText="取消" okText="確認" placeholder="按金客戶">
                    <ion-select-option value="">全部</ion-select-option>
                    <ion-select-option value="true">有按金未退還</ion-select-option>
                    <ion-select-option value="false">沒有按金未退還</ion-select-option>
                </ion-select>
            </ion-col>
            <ion-col size-xs="12" size-sm="12" size-md="4" size-lg="4" class="ion-align-self-center">
                <ion-select (ionChange)="resetAndGetData($event)" class="filter-ion-select" interface="popover"
                    mode="ios" [(ngModel)]="order" multiple="false" cancelText="取消" okText="確認" placeholder="訂單狀態">
                    <ion-select-option value="">全部</ion-select-option>
                    <ion-select-option value="true">有進行中訂單</ion-select-option>
                    <ion-select-option value="false">沒有進行中訂單</ion-select-option>
                </ion-select>
            </ion-col>
            <ion-col size-xs="12" size-sm="12" size-md="4" size-lg="4" class="ion-align-self-center">
                <ion-searchbar class="default-searchbar" mode="ios" placeholder="搜尋關鍵字" inputmode="text" type="text"
                    [(ngModel)]="key_word" [formControl]="searchControl"></ion-searchbar>
            </ion-col>
        </ion-row>
    </div>
    <div class="ion-margin table_container">
        <ion-row class="table_header full-width hidden-sm-down">
            <ion-col size="1">
                <ion-button class="default-ion-btn fit-content sort_header_btn" (click)="switchSorting('id')">
                    <ion-icon *ngIf="sorting == 'id' && direction == 'ASC'" slot="start" name="arrow-up-outline">
                    </ion-icon>
                    <ion-icon *ngIf="sorting == 'id' && direction == 'DESC'" slot="start" name="arrow-down-outline">
                    </ion-icon>
                    ID
                </ion-button>
            </ion-col>
            <ion-col size="1.5">
                <ion-button class="default-ion-btn fit-content sort_header_btn" (click)="switchSorting('create_date')">
                    <ion-icon *ngIf="sorting == 'create_date' && direction == 'ASC'" slot="start"
                        name="arrow-up-outline">
                    </ion-icon>
                    <ion-icon *ngIf="sorting == 'create_date' && direction == 'DESC'" slot="start"
                        name="arrow-down-outline">
                    </ion-icon>
                    註冊日期
                </ion-button>
            </ion-col>
            <ion-col size="1.5">
                <ion-button disabled class="disabled default-ion-btn fit-content sort_header_btn">
                    用戶名稱(電話)
                </ion-button>
            </ion-col>
            <ion-col size="2.5">
                <ion-button disabled class="disabled default-ion-btn fit-content sort_header_btn">
                    問券
                </ion-button>
            </ion-col>
            <ion-col size="1">
                <ion-button disabled class="disabled default-ion-btn fit-content sort_header_btn">
                    按金客戶
                </ion-button>
            </ion-col>
            <ion-col size="1">
                <ion-button disabled class="disabled default-ion-btn fit-content sort_header_btn">
                    租用狀態
                </ion-button>
            </ion-col>
            <ion-col size="3.5"></ion-col>
        </ion-row>

        <ng-container *ngIf="dataService?.table_data_list == null">
            <ion-row class="table_content full-width ske_table_content" *ngFor="let item of [].constructor(10)">
                <ion-col size="1">
                </ion-col>
                <ion-col size="1.5">
                </ion-col>
                <ion-col size="1.5">
                </ion-col>
                <ion-col size="2.5">
                </ion-col>
                <ion-col size="1">
                </ion-col>
                <ion-col size="1">
                </ion-col>
                <ion-col size="3.5">
                </ion-col>
            </ion-row>
        </ng-container>

        <ng-container *ngIf="dataService?.table_data_list != null && dataService?.table_data_list.length == 0">
            <ion-row class="table_content full-width ske_table_content">
                <ion-col size="12">
                    <h3>找不到用戶</h3>
                </ion-col>
            </ion-row>
        </ng-container>

        <ng-container *ngIf="dataService?.table_data_list != null">
            <ion-row class="table_content full-width" *ngFor="let item of dataService.table_data_list">
                <ion-col size-xs="12" size-sm="12" size-md="1" size-lg="1">
                    <span class="hidden-md-up">ID：</span>
                    <span>{{item.id}}</span>
                </ion-col>
                <ion-col size-xs="12" size-sm="12" size-md="1.5" size-lg="1.5">
                    <span class="hidden-md-up">註冊日期：</span>
                    <span>{{item.create_date | date : 'yyyy-MM-dd HH:mm'}}</span>
                </ion-col>
                <ion-col size-xs="12" size-sm="12" size-md="1.5" size-lg="1.5">
                    <span class="hidden-md-up">用戶名稱：</span>
                    <span>
                        {{item.username}} 
                        <br>
                        {{item.phone}}
                        <br>
                        {{item?.auto_charge_adyen_payment_method_id != '' ? '已綁定信用卡' : '未綁定信用卡'}}
                    </span>
                </ion-col>
                <ion-col size-xs="12" size-sm="12" size-md="2" size-lg="2.5">
                    <span class="hidden-md-up">問券：</span>
                    <span>
                        <ng-container *ngIf="item?.preference != null">
                            屋住地點：{{'onboarding_form.'+item.preference.living_distinct | translate}}
                            <br>
                            工作地點：{{'onboarding_form.'+item.preference.working_distinct | translate}}
                            <!-- <br>
                            喜愛計劃：<span *ngFor="let i of item.preference.interested_plan">{{'onboarding_form.'+i | translate}},</span>
                            <br>
                            喜愛車款：<span *ngFor="let i of item.preference.interested_type">{{'onboarding_form.'+i | translate}},</span> -->
                        </ng-container>
                    </span>
                </ion-col>

                <ion-col size-xs="12" size-sm="12" size-md="1" size-lg="1">
                    <span class="hidden-md-up">按金客戶：</span>
                    <span [class]="item.having_deposit ? 'have-deposit' : 'no-deposit'">{{item.having_deposit ? '有按金' :
                        '沒有按金'}}</span>
                </ion-col>
                <ion-col size-xs="12" size-sm="12" size-md="1" size-lg="1">
                    <span class="hidden-md-up">租用狀態</span>
                    <span [class]="item.having_order ? 'have-deposit' : 'no-deposit'">{{item.having_order ? '有進行中訂單' :
                        '沒有進行中訂單'}}</span>
                </ion-col>
                <ion-col size-xs="12" size-sm="12" size-md="3.5" size-lg="3.5">
                    <ion-button (click)="commonService?.openCMSPage('/user-detail?user_id='+item.id, 'root')"
                        class="default-ion-btn" fill="clear">
                        查看或更改
                    </ion-button>
                    <ion-button
                        (click)="commonService?.openCMSPage('/order?page=1&limit=10&sorting=null&direction=null&key_word=&status=&create_date_start=&create_date_end=&booking_date_start=&booking_date_end=&user_id='+item.id+'&car_id=', 'root')"
                        class="default-ion-btn" fill="clear">
                        租務紀錄
                    </ion-button>
                </ion-col>
            </ion-row>

            <ion-row class="table_footer full-width" *ngIf="dataService?.table_data_list.length > 0">
                <ion-col size-xs="12" size-sm="12" size-md="8" size-lg="8">
                    <div class="nav_container space_between full-width">
                        <div class="left_part">
                            <ion-button [disabled]="page == 1" (click)="goPreviousPage()"
                                class="default-ion-btn fit-content nav_page_btn">
                                <ion-icon name="chevron-back-outline"></ion-icon>
                                <span class="ion-margin-start" class="hidden-sm-down">上一頁</span>
                            </ion-button>
                        </div>
                        <div class="middle_part">
                            <ion-button *ngIf="page != 1" (click)="selectPage(1)"
                                class="default-ion-btn fit-content page_num_btn">
                                <ion-icon name="caret-back-outline"></ion-icon>
                            </ion-button>
                            <ion-button *ngIf="page-2 >= 1" (click)="selectPage(page-2)"
                                class="default-ion-btn fit-content page_num_btn hidden-sm-down">
                                {{page-2}}
                            </ion-button>
                            <ion-button *ngIf="page-1 >= 1" (click)="selectPage(page-1)"
                                class="default-ion-btn fit-content page_num_btn">
                                {{page-1}}
                            </ion-button>
                            <ion-button (click)="selectPage(page)"
                                class="default-ion-btn fit-content current_page_num_btn">
                                {{page}}
                            </ion-button>
                            <ion-button *ngIf="page+1 <= dataService?.table_data_number_of_page"
                                (click)="selectPage(page+1)" class="default-ion-btn fit-content page_num_btn">
                                {{page+1}}
                            </ion-button>
                            <ion-button *ngIf="page+2 <= dataService?.table_data_number_of_page"
                                (click)="selectPage(page+2)"
                                class="default-ion-btn fit-content page_num_btn hidden-sm-down">
                                {{page+2}}
                            </ion-button>
                            <ion-button *ngIf="page != dataService?.table_data_number_of_page"
                                (click)="selectPage(dataService.table_data_number_of_page)"
                                class="default-ion-btn fit-content page_num_btn">
                                <ion-icon name="caret-forward-outline"></ion-icon>
                            </ion-button>
                        </div>
                        <div class="right_part">
                            <ion-button [disabled]="page == dataService?.table_data_number_of_page"
                                (click)="goNextPage()" class="default-ion-btn fit-content nav_page_btn">
                                <ion-icon slot="end" name="chevron-forward-outline"></ion-icon>

                                <span class="ion-margin-end" class="hidden-sm-down">下一頁</span>
                            </ion-button>
                        </div>
                    </div>

                </ion-col>
                <ion-col size-xs="12" size-sm="12" size-md="4" size-lg="4">
                    <div class="table_pagination_option">
                        <p class="display_info">
                            顯示
                            {{(page-1)*limit+dataService?.table_data_list.length}}／{{dataService?.table_data_total_number}}（共{{dataService.table_data_number_of_page}}頁）
                        </p>
                        <mat-select (selectionChange)="limitChange($event)" class="table_limit"
                            [value]="limit.toString()">
                            <mat-option value="10">10</mat-option>
                            <mat-option value="25">25</mat-option>
                            <mat-option value="50">50</mat-option>
                            <mat-option value="100">100</mat-option>
                            <mat-option value="500">500</mat-option>
                        </mat-select>
                    </div>

                </ion-col>
            </ion-row>
        </ng-container>
    </div>
</ion-content>